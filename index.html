<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bíblia online</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link href="./styles/index.css" rel="stylesheet">

</head>
<body>
    <section class="container-menu">
        <h4> Bíblia NVI - IHA </h4>
    </section>

    <section class="container-menu">
        <select id="books" class="form-select" aria-label="Default"></select>
    
        <select id="chapter" class="form-select"></select>

        <button onclick="getVersiculo();" class="btn btn-primary">carregar</button>
    </section>

    <section class="container-txt">
        <p id="texto"></p>

        <section class="btns-navigators" style="margin-top: 1em; display: flex; justify-content: center;">
            <a class="btn btn-primary" style="margin-right: 4em;" onclick="updatePage('preview')"><</a>
            <a class="btn btn-primary" onclick="updatePage('next')">></a>
        </section>
    </section>
</body>
</html>

<script>

let token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IlNhdCBBcHIgMTUgMjAyMyAwMDoyMDozMSBHTVQrMDAwMC5tYXNhbm9yaS5paGFAZ21haWwuY29tIiwiaWF0IjoxNjgxNTE4MDMxfQ.QIH8WoMHghWSljgVJq9DwO2LmhMQb_xnWQo4YlGPu-E';

var options = {  
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json',
        'Authorization': 'bearer ' + token
      }
    }

let baseUrl = 'https://www.abibliadigital.com.br/api';
let books = [];

setTimeout(() => {
    getBooks();
    
}, 500)

function getBooks(){
    fetch(baseUrl + '/books', options)
        .then((result) => result.json())
        .then(data => {
            data.forEach(item => {
                let abbrev = item.abbrev.pt;
                let name = item.name;
                let chapter = item.chapters;

                books.push({abbrev, name, chapter});
            });

            
        })
        .finally(() => {
            let str = '';

            books.forEach(caption => {
                str += "<option value=" + caption.abbrev +">" + caption.name + "</option>";
            });

            document.querySelector('#books').innerHTML = str;

            getChaptersCount('sl');
            getVersiculo();
        })
        .catch(error => console.log(error));
}

function getChaptersCount(bookAbbrev){
    let str = '';

    let _book = books.find(b => b.abbrev == bookAbbrev);

    for (let index = 1; index <= _book.chapter; index++) {
        str += "<option value=" + index +">" + index + "</option>";        
    }
    
    document.querySelector('#chapter').innerHTML = str;
}

function getVersiculo(){
    let book = ObterValorHtml('books', 'id');
    let chapter = ObterValorHtml('chapter', 'id');

    var texto = '<p>';

    fetch(baseUrl + '/verses/nvi/' + book + '/' + chapter, options) 
        .then((result) => result.json())
        .then(function(data) {
            let livro = data.book.name;
            let chapters = data.verses;

            chapters.forEach((element) => {   
                console.log(element)           
                texto +=    element.number + '. ' + element.text + '</p> <p>';
            });

            document.querySelector('#texto').innerHTML = texto;
        })

}

function ObterValorHtml(chave, tipo){
    if(tipo == 'classe')
        return document.querySelector('.' + chave).value;
    else
        return document.getElementById(chave).value;
}

let SelectBooks = document.querySelector('#books');
SelectBooks.addEventListener('change',(e) => {
    let abbrev = SelectBooks.value;
    getChaptersCount(abbrev)
});

</script>